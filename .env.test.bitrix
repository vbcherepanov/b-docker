# ============================================================================
# BITRIX DOCKER - TEST/STAGING ENVIRONMENT
# Тестовое окружение (staging, pre-production)
# ============================================================================

# ============================================================================
# ОСНОВНЫЕ НАСТРОЙКИ
# ============================================================================
COMPOSE_PROJECT_NAME=bitrix
ENVIRONMENT=test
DEBUG=0
TZ=Europe/Moscow

# Домен для test сервера
DOMAIN=test.bitrix.com
EMAIL=devops@bitrix.com

# ============================================================================
# PHP НАСТРОЙКИ
# ============================================================================
PHP_VERSION=8.3

# PHP-FPM Pool настройки (для test - приближено к prod)
PHP_FPM_PM=dynamic
PHP_FPM_MAX_CHILDREN=40
PHP_FPM_START_SERVERS=5
PHP_FPM_MIN_SPARE_SERVERS=5
PHP_FPM_MAX_SPARE_SERVERS=20

# PHP лимиты (для test - как в prod)
PHP_MEMORY_LIMIT=256M
PHP_UPLOAD_MAX_FILESIZE=64M
PHP_POST_MAX_SIZE=64M
PHP_MAX_EXECUTION_TIME=300
PHP_MAX_INPUT_TIME=300

# OPcache (для test - включен как в prod)
PHP_OPCACHE_ENABLE=1
PHP_OPCACHE_MEMORY=256
PHP_OPCACHE_MAX_FILES=20000

# Security (для test - session.cookie_secure = On т.к. используется HTTPS)
SESSION_COOKIE_SECURE=On

# ============================================================================
# ПОЛЬЗОВАТЕЛЬ И ГРУППА
# ============================================================================
UID=1000
GID=1000
UGN=bitrix

# ============================================================================
# СЕТЕВЫЕ НАСТРОЙКИ
# ============================================================================
DOCKER_SUBNET=172.20.0.0/16

# Порты
HTTP_PORT=80
HTTPS_PORT=443

# ============================================================================
# MYSQL - БАЗА ДАННЫХ
# ============================================================================
DB_HOST=mysql
DB_PORT=3306
DB_NAME=bitrix_test
DB_USERNAME=bitrix
DB_PASSWORD=CHANGE_ME_bitrix_test_very_strong_password_abc123
DB_ROOT_PASSWORD=CHANGE_ME_root_test_very_strong_password_xyz789

# MySQL настройки (для test - приближено к prod)
MYSQL_INNODB_BUFFER_POOL_SIZE=1536M
MYSQL_MAX_CONNECTIONS=200
MYSQL_MEMORY_LIMIT=3G
MYSQL_MEMORY_RESERVATION=2G

# ============================================================================
# REDIS - КЭШИРОВАНИЕ
# ============================================================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=CHANGE_ME_redis_test_very_strong_password
REDIS_MAX_MEMORY=768mb

# ============================================================================
# MEMCACHED - ДОПОЛНИТЕЛЬНОЕ КЭШИРОВАНИЕ
# ============================================================================
MEMCACHED_HOST=memcached
MEMCACHED_PORT=11211
MEMCACHED_MEMORY_LIMIT=512
MEMCACHED_THREADS=4
MEMCACHED_CONN_LIMIT=2048

# ============================================================================
# RABBITMQ - ОЧЕРЕДИ
# ============================================================================
RABBITMQ_HOST=amqp
RABBIT_PORT=5672
RABBIT_UI_PORT=15672
RABBIT_COOKIE=CHANGE_ME_test_rabbitmq_cookie_very_strong_random_string
RABBITMQ_DEFAULT_USER=rabbitmq
RABBITMQ_DEFAULT_PASS=CHANGE_ME_rabbitmq_test_very_strong_password
RABBITMQ_DEFAULT_VHOST=/

# ============================================================================
# SSL НАСТРОЙКИ
# ============================================================================
# Для test - Let's Encrypt
SSL=2

# ============================================================================
# NGINX КОНФИГУРАЦИЯ
# ============================================================================
MAIL_CONFIG=1
RABBIT_CONFIG=1
DOLLAR=$

# ============================================================================
# BITRIX НАСТРОЙКИ
# ============================================================================
BITRIX_VM_VER=9.0.0

# ============================================================================
# МОНИТОРИНГ И ЛОГИРОВАНИЕ
# ============================================================================
GRAFANA_PORT=3000
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_grafana_test_secure_password

PROMETHEUS_PORT=9090

# ============================================================================
# БЭКАПЫ
# ============================================================================
BACKUP_SCHEDULE_DB=0 2 * * *
BACKUP_SCHEDULE_FILES=0 3 * * *
BACKUP_RETENTION_DAYS=30

# ============================================================================
# PORTAINER AGENT
# ============================================================================
PORTAINER_PORT=9001
PORTAINER_AGENT_SECRET=CHANGE_ME_portainer_test_secure_secret

# ============================================================================
# БЕЗОПАСНОСТЬ И ПРОФИЛИ
# ============================================================================
# Для test включаем все: monitoring, security, backup
COMPOSE_PROFILES=test,monitoring,security,backup
