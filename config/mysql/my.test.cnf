# ============================================================================
# MYSQL CONFIGURATION FOR BITRIX - LOCAL DEVELOPMENT
# Конфигурация MySQL для локальной разработки
# Оптимизировано под: 1С-Битрикс, малая нагрузка, быстрая отладка
# ============================================================================

[mysqld]
# ============================================================================
# ОСНОВНЫЕ НАСТРОЙКИ
# ============================================================================
bind-address = 0.0.0.0
port = 3306
datadir = /var/lib/mysql
socket = /var/run/mysqld/mysqld.sock
pid-file = /var/run/mysqld/mysqld.pid

# Timezone
default-time-zone = "+03:00"

# Пропускаем разрешение имен хостов (ускорение подключений)
skip-name-resolve = 1

# ============================================================================
# КОДИРОВКА (UTF8MB4 - полная поддержка Unicode, включая эмодзи)
# ============================================================================
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
init-connect = "SET NAMES utf8mb4"

# ============================================================================
# INNODB НАСТРОЙКИ
# ============================================================================
# Режим строгости (OFF для совместимости с Битрикс)
innodb_strict_mode = OFF

# Один файл на таблицу (лучше для резервного копирования)
innodb_file_per_table = 1

# Буфер пул (для local - 512MB, для сервера с 8GB RAM)
innodb_buffer_pool_size = 512M

# Количество инстансов буфер пула (рекомендуется 1 на 1GB)
innodb_buffer_pool_instances = 1

# Метод flush (O_DIRECT минимизирует двойное буферизование)
# NOTE: O_DIRECT not supported on macOS/ARM - commenting out for compatibility
# innodb_flush_method = O_DIRECT

# Flush лога при коммите (2 = быстрее, но риск потери данных при крахе)
# Для local - производительность важнее надежности
innodb_flush_log_at_trx_commit = 2

# Redo log capacity (512MB для local)
innodb_redo_log_capacity = 536870912

# Буфер для лога
innodb_log_buffer_size = 16M

# Timeout для блокировок (120 сек)
innodb_lock_wait_timeout = 120

# Файл для временных таблиц
innodb_temp_data_file_path = ibtmp1:12M:autoextend

# ============================================================================
# ПРОИЗВОДИТЕЛЬНОСТЬ И КЭШИРОВАНИЕ
# ============================================================================
# Максимум подключений (для local - меньше)
max_connections = 100

# Кэш потоков
thread_cache_size = 16

# Размер стека потока
thread_stack = 256K

# Кэш открытых таблиц
table_open_cache = 400
table_definition_cache = 400

# Буферы для сортировки и join
sort_buffer_size = 2M
join_buffer_size = 2M
read_buffer_size = 1M
read_rnd_buffer_size = 4M

# Временные таблицы
tmp_table_size = 64M
max_heap_table_size = 64M

# Максимальный размер пакета
max_allowed_packet = 128M

# Буфер для MyISAM таблиц (legacy, но может использоваться)
key_buffer_size = 128M

# ============================================================================
# BITRIX СПЕЦИФИЧНЫЕ НАСТРОЙКИ
# ============================================================================
# Уровень изоляции транзакций (рекомендация Битрикс)
transaction-isolation = READ-COMMITTED

# SQL mode (пустой для совместимости с Битрикс)
sql_mode = ""

# Отключаем binary logging (для local не нужен)
skip-log-bin = 1
binlog_expire_logs_seconds = 0

# Отключаем реплик�цию
skip-slave-start = 1

# ============================================================================
# ЛОГИРОВАНИЕ
# ============================================================================
# General log (отключен по умолчанию, включить для отладки)
general_log = 0
general_log_file = /var/log/mysql/general.log

# Error log
log_error = /var/log/mysql/error.log

# Slow query log (включен для отладки)
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2
log_queries_not_using_indexes = 1

# ============================================================================
# БЕЗОПАСНОСТЬ
# ============================================================================
# Для local - более мягкие настройки
local_infile = 1

# ============================================================================
# ПРОЧИЕ НАСТРОЙКИ
# ============================================================================
# Интерактивный timeout (8 часов)
interactive_timeout = 28800
wait_timeout = 28800

# Сохранение lowercase для имен таблиц (0 = case-sensitive)
# Для совместимости Windows/Linux рекомендуется 1
lower_case_table_names = 0

[mysql]
default-character-set = utf8mb4

[mysqldump]
quick
quote-names
max_allowed_packet = 128M

[client]
port = 3306
socket = /var/run/mysqld/mysqld.sock
default-character-set = utf8mb4
