# ============================================================================
# LOGROTATE CONFIGURATION FOR BITRIX DOCKER
# Rotates application logs in ./volume/logs/
# Run daily via cron or manually: make logs-rotate
# ============================================================================

# Global settings
weekly
rotate 4
compress
delaycompress
missingok
notifempty
create 0644 root root

# ============================================================================
# NGINX LOGS
# ============================================================================
/var/log/app/nginx/*.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 0644 nginx nginx
    sharedscripts
    postrotate
        # Signal nginx to reopen logs
        [ -f /var/run/nginx.pid ] && kill -USR1 `cat /var/run/nginx.pid` 2>/dev/null || true
    endscript
}

# ============================================================================
# PHP-FPM LOGS
# ============================================================================
/var/log/app/php-fpm/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0644 www-data www-data
}

# ============================================================================
# PHP ERROR LOGS
# ============================================================================
/var/log/app/php/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0644 www-data www-data
}

# ============================================================================
# BITRIX LOGS
# ============================================================================
/var/log/app/bitrix/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 0644 www-data www-data
}

# ============================================================================
# CRON LOGS
# ============================================================================
/var/log/app/cron/*.log {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
    create 0644 root root
}

# ============================================================================
# SUPERVISOR LOGS
# ============================================================================
/var/log/app/supervisor/*.log {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
    create 0644 root root
}

# ============================================================================
# MSMTP LOGS
# ============================================================================
/var/log/app/msmtp/*.log {
    weekly
    rotate 4
    compress
    delaycompress
    missingok
    notifempty
    create 0644 root root
}

# ============================================================================
# LETSENCRYPT LOGS
# ============================================================================
/var/log/app/letsencrypt/*.log {
    monthly
    rotate 6
    compress
    delaycompress
    missingok
    notifempty
    create 0644 root root
}
