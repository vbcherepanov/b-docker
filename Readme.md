# Bitrix Docker Environment

**bitrix-docker** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ –Ω–∞ 1C-Bitrix —Å –ø–æ–ª–Ω—ã–º —Å—Ç–µ–∫–æ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –±—ç–∫–∞–ø–∞–º–∏ –∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º.

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ Dockerfile:
1. **–õ–æ–≥–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ —É—Å–ª–æ–≤–∏—è—Ö** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ `||` –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è xdebug –≤ –ø—Ä–æ–¥–∞–∫—à–Ω
2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä** - –∑–∞–º–µ–Ω–µ–Ω `microdnf` –Ω–∞ `apt-get` –¥–ª—è MySQL –æ–±—Ä–∞–∑–∞
3. **–û–ø–µ—á–∞—Ç–∫–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ `DOLLAD` –Ω–∞ `DOLLAR`

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Makefile:
1. **–£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã** - –æ—á–∏—â–µ–Ω –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö —Ü–µ–ª–µ–π
2. **–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –µ–¥–∏–Ω—ã–º compose —Ñ–∞–π–ª–æ–º
3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** –º–µ–∂–¥—É –∫–æ–º–∞–Ω–¥–∞–º–∏

### –ù–æ–≤—ã–π –µ–¥–∏–Ω—ã–π docker-compose:
- **–ü—Ä–æ—Ñ–∏–ª–∏ –¥–ª—è –æ–∫—Ä—É–∂–µ–Ω–∏–π**: local, dev, prod, monitoring, backup, portainer
- **–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤–æ –≤—Å–µ—Ö –ø—Ä–æ—Ñ–∏–ª—è—Ö** - MySQL, Redis, Memcached, MailHog –¥–æ—Å—Ç—É–ø–Ω—ã –≤–µ–∑–¥–µ
- **–£–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏—è–º–∏** - Xdebug –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é ENVIRONMENT
- **–ì–∏–±–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ depends_on –¥–ª—è –≤—Å–µ—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π

## üìä –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–í—Å–µ –ª–æ–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤ Promtail ‚Üí Loki ‚Üí Grafana:**

- **Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã** - –ª–æ–≥–∏ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ Docker Socket
- **Nginx** - access/error –ª–æ–≥–∏ —Å –ø–∞—Ä—Å–∏–Ω–≥–æ–º HTTP —Å—Ç–∞—Ç—É—Å–æ–≤
- **PHP-FPM** - –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ –∏ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- **MySQL** - –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ –ë–î
- **Redis** - –ª–æ–≥–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
- **Cron/Supervisor** - –ª–æ–≥–∏ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á

**–î–æ—Å—Ç—É–ø –∫ –ª–æ–≥–∞–º:**
- Grafana UI: `http://localhost:3000` (admin/admin)
- Prometheus: `http://localhost:9090`
- Loki: `http://localhost:3100`

## ‚öôÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç:
- **CPU**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —è–¥–µ—Ä ‚Üí –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ worker_processes, max_children
- **RAM**: –æ–±—ä–µ–º –ø–∞–º—è—Ç–∏ ‚Üí innodb_buffer_pool_size, memory_limit, Redis maxmemory
- **–û–∫—Ä—É–∂–µ–Ω–∏–µ**: local/dev/prod ‚Üí –≤–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ debug-—Å–µ—Ä–≤–∏—Å–æ–≤

### –§–æ—Ä–º—É–ª—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

#### MySQL:
- `innodb_buffer_pool_size = 60% –æ—Ç RAM`
- `max_connections = 50 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –Ω–∞ CPU —è–¥—Ä–æ`
- `query_cache_size = 5% –æ—Ç RAM`

#### PHP-FPM:
- `max_children = CPU —è–¥—Ä–∞ √ó 5`
- `memory_limit = 256MB (‚â§8GB RAM) / 512MB (>8GB RAM)`

#### Redis:
- `maxmemory = 25% –æ—Ç RAM`

#### Nginx:
- `worker_processes = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ CPU —è–¥–µ—Ä`
- `worker_connections = 1024 (‚â§4GB RAM) / 2048 (>4GB RAM)`

## üìä –ü—Ä–æ—Ñ–∏–ª–∏ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### üß™ –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (`local`)
**–ö–æ–º–∞–Ω–¥—ã**: `make *-local`
**–í–∫–ª—é—á–∞–µ—Ç**:
- –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã PHP
- MySQL, Redis, Memcached
- MailHog –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—á—Ç—ã
- Xdebug –≤–∫–ª—é—á–µ–Ω
- –í—Å–µ –ª–æ–≥–∏ –≤ volume/logs/

### üè≠ –ü—Ä–æ–¥–∞–∫—à–Ω (`prod`)
**–ö–æ–º–∞–Ω–¥—ã**: `make *-prod`
**–í–∫–ª—é—á–∞–µ—Ç**:
- –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã PHP
- MySQL, Redis, Memcached (–ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–µ)
- MailHog –¥–æ—Å—Ç—É–ø–µ–Ω
- Xdebug –≤—ã–∫–ª—é—á–µ–Ω (—á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é ENVIRONMENT)
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏

### üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (`monitoring`)
**–ö–æ–º–∞–Ω–¥—ã**: `make *-monitoring`
**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ**:
- Grafana (–ø–æ—Ä—Ç 3000)
- Prometheus (–ø–æ—Ä—Ç 9090)
- Loki –¥–ª—è –ª–æ–≥–æ–≤
- Promtail –¥–ª—è —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤
- Node Exporter –¥–ª—è –º–µ—Ç—Ä–∏–∫ —Å–∏—Å—Ç–µ–º—ã

### üíæ –ë—ç–∫–∞–ø—ã (`backup`)
**–ö–æ–º–∞–Ω–¥—ã**: `make backup-*`
**–§—É–Ω–∫—Ü–∏–∏**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –ë–î –∏ —Ñ–∞–π–ª–æ–≤
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —á–µ—Ä–µ–∑ cron
- –†–æ—Ç–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –∞—Ä—Ö–∏–≤–æ–≤

### üéõÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (`portainer`)
**–ö–æ–º–∞–Ω–¥—ã**: `make portainer-*`
**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**:
- Portainer Agent –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **PHP 7.4 –∏ 8.3** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö –≤–µ—Ä—Å–∏–π PHP
- **–ï–¥–∏–Ω—ã–π docker-compose.yml** - —Å –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –¥–ª—è –≤—Å–µ—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - Promtail ‚Üí Loki ‚Üí Grafana
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –∫–æ–Ω—Ñ–∏–≥–∏ –ø–æ–¥ –∂–µ–ª–µ–∑–æ —Å —Ñ–æ—Ä–º—É–ª–∞–º–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Ñ–∞–π–ª—ã —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
- **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ self-signed, —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏ Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- **Portainer Agent** - –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤–æ –≤–Ω–µ—à–Ω–∏–µ —Ñ–∞–π–ª—ã
- **–û–∫—Ä—É–∂–µ–Ω–∏—è** - –æ—Ç–¥–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è local/dev/prod

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Web-—Å–µ—Ä–≤–µ—Ä**: Nginx
- **PHP**: PHP-FPM + PHP-CLI + Cron + Supervisor
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: MySQL (–¥–æ—Å—Ç—É–ø–Ω–∞ –≤–æ –≤—Å–µ—Ö –ø—Ä–æ—Ñ–∏–ª—è—Ö)
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: Redis + Memcached (–¥–æ—Å—Ç—É–ø–Ω—ã –≤–æ –≤—Å–µ—Ö –ø—Ä–æ—Ñ–∏–ª—è—Ö)
- **–û—á–µ—Ä–µ–¥–∏**: RabbitMQ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å)
- **–ü–æ—á—Ç–∞**: Mailhog (–¥–æ—Å—Ç—É–ø–µ–Ω –≤–æ –≤—Å–µ—Ö –ø—Ä–æ—Ñ–∏–ª—è—Ö)
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: Grafana, Prometheus, Loki, Promtail, Node Exporter
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: Portainer Agent
- **–ë—ç–∫–∞–ø—ã**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –±—ç–∫–∞–ø–æ–≤

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
cp .env.local.example .env
# –∏–ª–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω
cp .env.prod.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥ –≤–∞—à–∏ –Ω—É–∂–¥—ã
nano .env
```

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```bash
# –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∂–µ–ª–µ–∑–∞ + –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥–æ–≤
make auto-config

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å (–µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥–∏)
make auto-config-force

# –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω
make auto-config-prod

# –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
make auto-config-preview
```

### 3. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã)
make init-local

# –ü—Ä–æ–¥–∞–∫—à–Ω (–≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏)
make init-prod

# –° –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º (–≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã + Grafana, Prometheus, Loki)
make init-monitoring

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ docker compose:
# –¢–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose up -d

# –û—Å–Ω–æ–≤–Ω—ã–µ + –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
docker compose --profile monitoring up -d

# –û—Å–Ω–æ–≤–Ω—ã–µ + –±—ç–∫–∞–ø—ã
docker compose --profile backup up -d

# –í—Å–µ –ø—Ä–æ—Ñ–∏–ª–∏ —Å—Ä–∞–∑—É
docker compose --profile monitoring --profile backup --profile portainer up -d
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏—è |
|------------|----------|----------|
| `TZ` | –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞ | Europe/Moscow<br>**–í–∞–∂–Ω–æ**: –ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –ø—É—Å—Ç–∞—è –∏–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è UTC (+00:00) |
| `ENVIRONMENT` | –û–∫—Ä—É–∂–µ–Ω–∏–µ | local/dev/prod |
| `DEBUG` | –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ | 0/1 |
| `DOMAIN` | –î–æ–º–µ–Ω–Ω–æ–µ –∏–º—è | example.com |
| `EMAIL` | Email –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ | admin@example.com |
| `SSL` | –¢–∏–ø SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ | 0 - –±–µ–∑ SSL<br>1 - —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã<br>2 - Let's Encrypt |
| `UGN` | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | bitrix |
| `UID/GID` | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/–≥—Ä—É–ø–ø—ã | 1000 |

### –ü–æ—Ä—Ç—ã

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|----------------------|
| `HTTP_PORT` | HTTP –ø–æ—Ä—Ç | 80 |
| `HTTPS_PORT` | HTTPS –ø–æ—Ä—Ç | 443 |
| `DB_PORT` | MySQL –ø–æ—Ä—Ç (–ª–æ–∫–∞–ª—å–Ω–æ) | 3306 |
| `REDIS_PORT` | Redis –ø–æ—Ä—Ç (–ª–æ–∫–∞–ª—å–Ω–æ) | 6379 |
| `RABBIT_PORT` | RabbitMQ AMQP –ø–æ—Ä—Ç | 5672 |
| `RABBIT_UI_PORT` | RabbitMQ UI –ø–æ—Ä—Ç | 15672 |
| `GRAFANA_PORT` | Grafana –ø–æ—Ä—Ç | 3000 |
| `PROMETHEUS_PORT` | Prometheus –ø–æ—Ä—Ç | 9090 |
| `PORTAINER_PORT` | Portainer Agent –ø–æ—Ä—Ç | 9443 |

### PHP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏—è |
|------------|----------|----------|
| `PHP_VERSION` | –í–µ—Ä—Å–∏—è PHP | 7.4 –∏–ª–∏ 8.3 |
| `BITRIX_VM_VER` | –í–µ—Ä—Å–∏—è Bitrix VM | 7.5.2 |

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|
| `DB_HOST` | –•–æ—Å—Ç –ë–î (mysql –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–µ—Ä) |
| `DB_NAME` | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |
| `DB_USERNAME` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î |
| `DB_PASSWORD` | –ü–∞—Ä–æ–ª—å –ë–î |
| `DB_ROOT_PASSWORD` | Root –ø–∞—Ä–æ–ª—å MySQL |
| `REDIS_HOST` | –•–æ—Å—Ç Redis (redis –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–µ—Ä) |
| `MEMCACHED_HOST` | –•–æ—Å—Ç Memcached (memcached –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–π) |

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±—ç–∫–∞–ø–æ–≤

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------------|----------|---------|
| `BACKUP_SCHEDULE_DB` | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ –ë–î | 0 2 * * * |
| `BACKUP_SCHEDULE_FILES` | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ —Ñ–∞–π–ª–æ–≤ | 0 3 * * * |
| `BACKUP_RETENTION_DAYS` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è | 7 |
| `BACKUP_PATH` | –ü—É—Ç—å –¥–ª—è –±—ç–∫–∞–ø–æ–≤ | ./backups |

## üîß –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫
make init-local              # –ü–æ–ª–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
make init-prod               # –ü–æ–ª–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω
make up-local                # –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥—ã
make up-prod                 # –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥–∞–∫—à–Ω —Å—Ä–µ–¥—ã
make restart-local           # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥—ã
make down-local              # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥—ã

# –ê–≤—Ç–æ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
make auto-config             # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
make auto-config-force       # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∞–≤—Ç–æ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
make auto-config-prod        # –ê–≤—Ç–æ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω
make auto-config-preview     # –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä

# –†—É—á–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
make auto-config-manual CPU_CORES=8 RAM_GB=16
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∞–π—Ç–∞–º–∏:
```bash
make site-add DOMAIN=example.com         # –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å–∞–π—Ç
make site-remove DOMAIN=example.com      # –£–¥–∞–ª–∏—Ç—å —Å–∞–π—Ç
make site-list                           # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–∞–π—Ç–æ–≤
make bitrix-site DOMAIN=mysite.local     # –°–æ–∑–¥–∞—Ç—å Bitrix —Å–∞–π—Ç
make site-clone FROM=old.com TO=new.com  # –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–∞–π—Ç
```

### SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:
```bash
make ssl-generate DOMAIN=example.com     # –°–æ–∑–¥–∞—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
make ssl-remove DOMAIN=example.com       # –£–¥–∞–ª–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
```

### –ë—ç–∫–∞–ø—ã:
```bash
make backup-db                           # –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
make backup-files                        # –ë—ç–∫–∞–ø —Ñ–∞–π–ª–æ–≤
make backup-full                         # –ü–æ–ª–Ω—ã–π –±—ç–∫–∞–ø
make backup-list                         # –°–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤
make backup-restore-db FILE=backup.sql.gz
make backup-restore-files FILE=backup.tar.gz
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏:
```bash
make logs-nginx-local                    # –õ–æ–≥–∏ Nginx
make logs-php-local                      # –õ–æ–≥–∏ PHP-FPM
make status-local                        # –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏–π:
```bash
make set-local                           # –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ local
make set-dev                             # –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ dev
make set-prod                            # –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ prod
```

### –ü–æ–º–æ—â—å:
```bash
make help                                # –û—Å–Ω–æ–≤–Ω–∞—è —Å–ø—Ä–∞–≤–∫–∞
make help-sites                          # –°–ø—Ä–∞–≤–∫–∞ –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å–∞–π—Ç–∞–º–∏
make help-backup                         # –°–ø—Ä–∞–≤–∫–∞ –ø–æ –±—ç–∫–∞–ø–∞–º
make help-autoconfig                     # –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∞–≤—Ç–æ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
b-docker/
‚îú‚îÄ‚îÄ docker-compose.yml                  # –ï–¥–∏–Ω—ã–π compose —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ Makefile                            # –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .env.local.example                  # –ü—Ä–∏–º–µ—Ä –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ .env.prod.example                   # –ü—Ä–∏–º–µ—Ä –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω
‚îú‚îÄ‚îÄ docker/                            # Dockerfile'—ã —Å–µ—Ä–≤–∏—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ nginx/                         # Nginx + PHP-FPM
‚îÇ   ‚îú‚îÄ‚îÄ php/                           # PHP –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ mysql/                         # MySQL
‚îÇ   ‚îú‚îÄ‚îÄ redis/                         # Redis
‚îÇ   ‚îú‚îÄ‚îÄ memcached/                     # Memcached
‚îÇ   ‚îú‚îÄ‚îÄ mailhog/                       # MailHog (dev)
‚îÇ   ‚îî‚îÄ‚îÄ backup/                        # –°–∏—Å—Ç–µ–º–∞ –±—ç–∫–∞–ø–æ–≤
‚îú‚îÄ‚îÄ config/                            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ nginx/                         # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Nginx
‚îÇ   ‚îú‚îÄ‚îÄ php/                           # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ PHP
‚îÇ   ‚îú‚îÄ‚îÄ mysql/                         # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ MySQL
‚îÇ   ‚îú‚îÄ‚îÄ redis/                         # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Redis
‚îÇ   ‚îî‚îÄ‚îÄ grafana/                       # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚îú‚îÄ‚îÄ scripts/                           # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ auto-config.sh                 # –ê–≤—Ç–æ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ site-manager.sh                # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∞–π—Ç–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ backup-manager.sh              # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—ç–∫–∞–ø–∞–º–∏
‚îî‚îÄ‚îÄ www/                               # –ö–æ–¥ –ø—Ä–æ–µ–∫—Ç–æ–≤
    ‚îî‚îÄ‚îÄ [–¥–æ–º–µ–Ω]/                       # –ü–∞–ø–∫–∞ —Å–∞–π—Ç–∞
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```bash
# –í–∞–ª–∏–¥–∞—Ü–∏—è docker-compose
docker compose -f docker-compose.yml config

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
make check-nginx-local

# –¢–µ—Å—Ç PHP
make bash-cli-local
php -v
```

### –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞:
```bash
# –í—Å–µ –ª–æ–≥–∏ –≤ ./volume/logs/
ls -la volume/logs/

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
make logs-nginx-local
make logs-php-local

# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
make status-local
```

## üö® –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–°–º–µ–Ω–∏—Ç–µ –≤—Å–µ –ø–∞—Ä–æ–ª–∏** –≤ `.env` —Ñ–∞–π–ª–µ
2. **–û—Ç–∫–ª—é—á–∏—Ç–µ debug —Ä–µ–∂–∏–º—ã** (`DEBUG=0`)
3. **–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã** –¥–ª—è –ë–î –∏ Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª** –¥–ª—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤
5. **–í–∫–ª—é—á–∏—Ç–µ SSL** (`SSL=2` –¥–ª—è Let's Encrypt)
6. **–†–æ—Ç–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏** –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω:
```bash
ENVIRONMENT=prod
DEBUG=0
# –î–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
DB_HOST=mysql
REDIS_HOST=redis
# –ò–ª–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
# DB_HOST=external-mysql.server.com
# REDIS_HOST=external-redis.server.com
GRAFANA_ADMIN_PASSWORD=strong_password
PORTAINER_AGENT_SECRET=strong_secret
```

## SSL –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç—Ä–∏ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã —Å SSL:

### SSL=0 - –ë–µ–∑ SSL
- HTTP –¥–æ—Å—Ç—É–ø –ø–æ –ø–æ—Ä—Ç—É 80
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### SSL=1 - –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- –ü–æ–º–µ—Å—Ç–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `./ssl/`
- –§–∞–π–ª—ã: `domain.crt` –∏ `domain.key`
- HTTPS –¥–æ—Å—Ç—É–ø –ø–æ –ø–æ—Ä—Ç—É 443

### SSL=2 - Let's Encrypt
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Grafana
- **URL**: http://localhost:3000
- **–õ–æ–≥–∏–Ω**: admin
- **–ü–∞—Ä–æ–ª—å**: admin (–∏–∑–º–µ–Ω–∏—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–Ω!)

### Prometheus
- **URL**: http://localhost:9090
- –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ —Å–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã
- –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞
- –ú–µ—Ç—Ä–∏–∫–∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –ú–µ—Ç—Ä–∏–∫–∏ Nginx
- –ú–µ—Ç—Ä–∏–∫–∏ MySQL
- –ú–µ—Ç—Ä–∏–∫–∏ Redis
- –ú–µ—Ç—Ä–∏–∫–∏ RabbitMQ
- –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

## –ë—ç–∫–∞–ø—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –±—ç–∫–∞–ø—ã —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é:
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 2:00
- –§–∞–π–ª—ã: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 3:00
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤: –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ –≤ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 4:00
- –ü–æ–ª–Ω—ã–π –±—ç–∫–∞–ø: –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ –≤ —Å—É–±–±–æ—Ç—É –≤ 1:00

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—ç–∫–∞–ø–æ–≤
```
./backups/
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ db_backup_20240915_020000.sql.gz
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ files/
    ‚îú‚îÄ‚îÄ files_backup_20240915_030000.tar.gz
    ‚îî‚îÄ‚îÄ ...
```

### –†—É—á–Ω—ã–µ –±—ç–∫–∞–ø—ã
–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –±—ç–∫–∞–ø—ã –≤—Ä—É—á–Ω—É—é —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥ make (—Å–º. –≤—ã—à–µ).

## Portainer Agent

–î–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Portainer –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∞–≥–µ–Ω—Ç—ã:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≥–µ–Ω—Ç: `make portainer-up` –∏–ª–∏ `make portainer-up-prod`
2. –í Portainer –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π endpoint —Ç–∏–ø–∞ "Agent"
3. –£–∫–∞–∂–∏—Ç–µ IP —Å–µ—Ä–≤–µ—Ä–∞ –∏ –ø–æ—Ä—Ç –∏–∑ `PORTAINER_PORT`
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç –∏–∑ `PORTAINER_AGENT_SECRET`

## –°–µ—Ç–µ–≤–æ–π –¥–æ—Å—Ç—É–ø

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ `.env` –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `DOMAIN=bitrix.local`
2. –î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª hosts:
   - **Windows**: `C:\Windows\System32\drivers\etc\hosts`
   - **macOS/Linux**: `/etc/hosts`
   - –°—Ç—Ä–æ–∫–∞: `127.0.0.1 bitrix.local`

### –£–¥–∞–ª–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø
- HTTP: `http://YOUR_SERVER_IP:HTTP_PORT`
- HTTPS: `https://YOUR_SERVER_IP:HTTPS_PORT`

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω:
1. –°–º–µ–Ω–∏—Ç–µ –≤—Å–µ –ø–∞—Ä–æ–ª–∏ –≤ `.env.prod`
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `DEBUG=0`
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (`SSL=2` –¥–ª—è Let's Encrypt)
4. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç–∞–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ firewall
5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ backup –Ω–∞ –≤–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
6. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–Ω–µ—à–Ω–∏–µ MySQL –∏ Redis —Å–µ—Ä–≤–µ—Ä–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ Docker –æ–±—Ä–∞–∑—ã
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–æ–Ω—ã

–í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é –∑–æ–Ω—É –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `TZ` –∏–∑ —Ñ–∞–π–ª–∞ `.env`:

- **–ï—Å–ª–∏ TZ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `TZ=Europe/Moscow`): –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω–∞—è –∑–æ–Ω–∞
- **–ï—Å–ª–∏ TZ –ø—É—Å—Ç–∞—è –∏–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω–∞**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è UTC (+00:00)
- **MySQL**: –≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ UTC (+00:00) –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã**: –≤—Å–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —á–∞—Å—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–æ–Ω–æ–π

## –†–∞–±–æ—Ç–∞ —Å –º—É–ª—å—Ç–∏—Å–∞–π—Ç–∞–º–∏

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–∞–π—Ç–æ–≤ –≤ –æ–¥–Ω–æ–º Docker –æ–∫—Ä—É–∂–µ–Ω–∏–∏. –ö–∞–∂–¥—ã–π —Å–∞–π—Ç –∏–º–µ–µ—Ç —Å–≤–æ—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ `./www/` –∏ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ PHP.

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–∞–π—Ç–æ–≤
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∞–π—Ç–∞
make site-add DOMAIN=main-site.com PHP_VERSION=8.3

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–∞–π—Ç–∞
make site-add DOMAIN=test.local PHP_VERSION=7.4

# –°–æ–∑–¥–∞–Ω–∏–µ Bitrix —Å–∞–π—Ç–∞
make bitrix-site DOMAIN=shop.local PHP_VERSION=8.3

# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —Å–∞–π—Ç–æ–≤
make site-list
```

#### –†–∞–±–æ—Ç–∞ —Å –±—ç–∫–∞–ø–∞–º–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å–∞–π—Ç–æ–≤
```bash
# –ë—ç–∫–∞–ø –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–∞–π—Ç–∞
make backup-full SITE=main-site.com

# –ë—ç–∫–∞–ø —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤
make backup-files SITE=test.local

# –ë—ç–∫–∞–ø —Ç–æ–ª—å–∫–æ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
make backup-db SITE=shop.local

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∞–π—Ç–∞
make backup-restore-files FILE=test_local_20240101_120000.tar.gz SITE=test.local
```

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ SSL –¥–ª—è –≤—Å–µ—Ö —Å–∞–π—Ç–æ–≤
make ssl-generate DOMAIN=main-site.com
make ssl-generate DOMAIN=test.local
make ssl-generate DOMAIN=shop.local

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ —Å–∞–π—Ç–∞
make site-clone FROM=main-site.com TO=staging.main-site.com
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å –º—É–ª—å—Ç–∏—Å–∞–π—Ç–∞–º–∏
```
./www/
‚îú‚îÄ‚îÄ main-site.com/
‚îÇ   ‚îî‚îÄ‚îÄ www/
‚îÇ       ‚îú‚îÄ‚îÄ index.php
‚îÇ       ‚îî‚îÄ‚îÄ bitrix/
‚îú‚îÄ‚îÄ test.local/
‚îÇ   ‚îî‚îÄ‚îÄ www/
‚îÇ       ‚îî‚îÄ‚îÄ index.php
‚îî‚îÄ‚îÄ shop.local/
    ‚îî‚îÄ‚îÄ www/
        ‚îú‚îÄ‚îÄ index.php
        ‚îú‚îÄ‚îÄ bitrix/
        ‚îî‚îÄ‚îÄ upload/

./config/nginx/conf/
‚îú‚îÄ‚îÄ main-site.com.conf
‚îú‚îÄ‚îÄ test.local.conf
‚îú‚îÄ‚îÄ shop.local.conf
‚îú‚îÄ‚îÄ ssl_main-site.com.conf
‚îú‚îÄ‚îÄ ssl_test.local.conf
‚îî‚îÄ‚îÄ ssl_shop.local.conf

./ssl/
‚îú‚îÄ‚îÄ main-site.com.crt
‚îú‚îÄ‚îÄ main-site.com.key
‚îú‚îÄ‚îÄ test.local.crt
‚îú‚îÄ‚îÄ test.local.key
‚îú‚îÄ‚îÄ shop.local.crt
‚îî‚îÄ‚îÄ shop.local.key
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã

Docker –æ–∫—Ä—É–∂–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞:

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å –¥–µ—Ç–µ–∫—Ç–æ–º –∂–µ–ª–µ–∑–∞
make auto-config                     # –î–ª—è —Ç–µ–∫—É—â–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
make auto-config-force               # –° –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å—é
make auto-config-prod                # –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω –æ–∫—Ä—É–∂–µ–Ω–∏—è

# –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
make auto-config-preview             # –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ

# –†—É—á–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
make auto-config-manual CPU_CORES=8 RAM_GB=16
```

#### –ß—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è:

- **MySQL**: buffer pool, connections, cache —Ä–∞–∑–º–µ—Ä—ã
- **Nginx**: worker processes, connections, client limits
- **Redis**: memory limits, databases, persistence
- **PHP-FPM**: process manager, memory limits, opcache
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**: –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

#### –ü—Ä–∏–º–µ—Ä –∞–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç–∞:
```
–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ: 12 CPU cores, 64GB RAM
- MySQL buffer pool: 19.6GB (60% RAM)
- Nginx workers: 12 (–ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —è–¥–µ—Ä)
- PHP-FPM children: 60 (5 –Ω–∞ —è–¥—Ä–æ)
- Redis memory: 16GB (25% RAM)
```

### –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –ø–æ–º–æ—â–∏
```bash
make help           # –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
make help-sites     # –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∞–π—Ç–∞–º–∏
make help-backup    # –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±—ç–∫–∞–ø–∞–º–∏
make help-autoconfig # –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –∞–≤—Ç–æ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
make status-local          # –õ–æ–∫–∞–ª—å–Ω–æ
make status                # –ü—Ä–æ–¥–∞–∫—à–Ω
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
make logs-nginx-local      # –õ–æ–≥–∏ Nginx
make logs-php-local        # –õ–æ–≥–∏ PHP
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
make restart-local         # –õ–æ–∫–∞–ª—å–Ω–æ
make restart               # –ü—Ä–æ–¥–∞–∫—à–Ω
```

### –û—á–∏—Å—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã
```bash
make clean-all             # –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ Docker
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ:
- Docker 20.10+
- Docker Compose 2.0+
- 4GB RAM
- 20GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ:
- 8GB+ RAM
- SSD –¥–∏—Å–∫
- 100GB+ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–º–æ—â–∏:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `make help` –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `make logs-nginx-local` –∏–ª–∏ `make logs-php-local`
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É: `make status-local`

---

**–°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ Bitrix**