# ============================================================================
# BITRIX DOCKER - PRODUCTION ENVIRONMENT
# Продакшн окружение - максимальная производительность и безопасность
# ============================================================================
# ВАЖНО: ОБЯЗАТЕЛЬНО СМЕНИТЕ ВСЕ ПАРОЛИ И СЕКРЕТЫ ПЕРЕД ЗАПУСКОМ!
# ============================================================================

# ============================================================================
# ОСНОВНЫЕ НАСТРОЙКИ
# ============================================================================
COMPOSE_PROJECT_NAME=bitrix
ENVIRONMENT=prod
DEBUG=0
TZ=Europe/Moscow

# Домен production сайта
DOMAIN=www.example.com
EMAIL=admin@example.com

# ============================================================================
# PHP НАСТРОЙКИ
# ============================================================================
PHP_VERSION=8.3

# PHP-FPM Pool настройки (для prod - оптимизировано под нагрузку)
# Рекомендация: max_children = RAM / 128MB (для сервера с 8GB RAM = 60)
PHP_FPM_PM=ondemand
PHP_FPM_MAX_CHILDREN=60
PHP_FPM_START_SERVERS=10
PHP_FPM_MIN_SPARE_SERVERS=5
PHP_FPM_MAX_SPARE_SERVERS=30

# PHP лимиты (для prod - консервативные значения)
PHP_MEMORY_LIMIT=256M
PHP_UPLOAD_MAX_FILESIZE=64M
PHP_POST_MAX_SIZE=64M
PHP_MAX_EXECUTION_TIME=300
PHP_MAX_INPUT_TIME=300

# OPcache (для prod - максимальная производительность)
PHP_OPCACHE_ENABLE=1
PHP_OPCACHE_MEMORY=512
PHP_OPCACHE_MAX_FILES=30000

# ============================================================================
# ПОЛЬЗОВАТЕЛЬ И ГРУППА
# ============================================================================
UID=1000
GID=1000
UGN=bitrix

# ============================================================================
# СЕТЕВЫЕ НАСТРОЙКИ
# ============================================================================
DOCKER_SUBNET=172.20.0.0/16

# Порты
HTTP_PORT=80
HTTPS_PORT=443

# ============================================================================
# MYSQL - БАЗА ДАННЫХ
# ============================================================================
# ВНИМАНИЕ: Для prod рекомендуется использовать внешний managed MySQL
# DB_HOST=your-mysql-server.example.com
DB_HOST=mysql
DB_PORT=3306
DB_NAME=bitrix_prod
DB_USERNAME=bitrix
# ОБЯЗАТЕЛЬНО СМЕНИТЕ ПАРОЛИ!
DB_PASSWORD=CHANGE_ME_IMMEDIATELY_very_strong_password_with_special_chars_!@#$%
DB_ROOT_PASSWORD=CHANGE_ME_IMMEDIATELY_root_very_strong_password_with_special_chars_!@#$%

# MySQL настройки (для prod - максимальная производительность)
# Для сервера с 16GB RAM:
# innodb_buffer_pool_size = 60% RAM = ~9.6GB
MYSQL_INNODB_BUFFER_POOL_SIZE=9600M
MYSQL_MAX_CONNECTIONS=300
MYSQL_MEMORY_LIMIT=12G
MYSQL_MEMORY_RESERVATION=10G

# ============================================================================
# REDIS - КЭШИРОВАНИЕ
# ============================================================================
# ВНИМАНИЕ: Для prod рекомендуется использовать внешний managed Redis
# REDIS_HOST=your-redis-server.example.com
REDIS_HOST=redis
REDIS_PORT=6379
# ОБЯЗАТЕЛЬНО СМЕНИТЕ ПАРОЛЬ!
REDIS_PASSWORD=CHANGE_ME_IMMEDIATELY_redis_very_strong_password_!@#$%
# Для prod - больше памяти (рекомендуется 10-20% от общей RAM сервера)
REDIS_MAX_MEMORY=2gb

# ============================================================================
# MEMCACHED - ДОПОЛНИТЕЛЬНОЕ КЭШИРОВАНИЕ
# ============================================================================
MEMCACHED_HOST=memcached
MEMCACHED_PORT=11211
MEMCACHED_MEMORY_LIMIT=1024
MEMCACHED_THREADS=8
MEMCACHED_CONN_LIMIT=4096

# ============================================================================
# RABBITMQ - ОЧЕРЕДИ
# ============================================================================
RABBITMQ_HOST=amqp
RABBIT_PORT=5672
RABBIT_UI_PORT=15672
# ОБЯЗАТЕЛЬНО СМЕНИТЕ COOKIE И ПАРОЛИ!
RABBIT_COOKIE=CHANGE_ME_IMMEDIATELY_rabbitmq_cookie_very_long_random_string_minimum_32_chars
RABBITMQ_DEFAULT_USER=rabbitmq
RABBITMQ_DEFAULT_PASS=CHANGE_ME_IMMEDIATELY_rabbitmq_very_strong_password_!@#$%
RABBITMQ_DEFAULT_VHOST=/

# ============================================================================
# SSL НАСТРОЙКИ
# ============================================================================
# Для prod - только Let's Encrypt (автоматическое продление)
SSL=2

# ============================================================================
# NGINX КОНФИГУРАЦИЯ
# ============================================================================
MAIL_CONFIG=0
RABBIT_CONFIG=1
DOLLAR=$

# ============================================================================
# BITRIX НАСТРОЙКИ
# ============================================================================
BITRIX_VM_VER=9.0.0

# ============================================================================
# МОНИТОРИНГ И ЛОГИРОВАНИЕ
# ============================================================================
GRAFANA_PORT=3000
# ОБЯЗАТЕЛЬНО СМЕНИТЕ ПАРОЛЬ GRAFANA!
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_IMMEDIATELY_grafana_very_strong_password_!@#$%

PROMETHEUS_PORT=9090

# ============================================================================
# БЭКАПЫ
# ============================================================================
# БД: каждый день в 2:00 ночи
BACKUP_SCHEDULE_DB=0 2 * * *
# Файлы: каждый день в 3:00 ночи
BACKUP_SCHEDULE_FILES=0 3 * * *
# Хранить бэкапы 30 дней
BACKUP_RETENTION_DAYS=30

# ============================================================================
# PORTAINER AGENT
# ============================================================================
PORTAINER_PORT=9001
# ОБЯЗАТЕЛЬНО СМЕНИТЕ СЕКРЕТ!
PORTAINER_AGENT_SECRET=CHANGE_ME_IMMEDIATELY_portainer_very_long_random_secret_minimum_32_chars

# ============================================================================
# БЕЗОПАСНОСТЬ И ПРОФИЛИ
# ============================================================================
# Для prod включаем ВСЕ профили: monitoring, security, backup
# НЕ включаем: local, dev (они для разработки)
COMPOSE_PROFILES=prod,monitoring,security,backup,full

# ============================================================================
# ДОПОЛНИТЕЛЬНЫЕ НАСТРОЙКИ БЕЗОПАСНОСТИ
# ============================================================================
# Firewall правила (настраивается отдельно на сервере)
# - Открыть только: 80, 443
# - Закрыть: 3306 (MySQL), 6379 (Redis), 9000 (PHP-FPM)
# - Доступ к мониторингу (3000, 9090) только из белого списка IP

# ============================================================================
# РЕКОМЕНДАЦИИ ПО БЕЗОПАСНОСТИ PRODUCTION
# ============================================================================
# 1. ОБЯЗАТЕЛЬНО смените все пароли выше (ищите CHANGE_ME_IMMEDIATELY)
# 2. Используйте managed БД и кэш (AWS RDS, DigitalOcean Managed Database)
# 3. Настройте firewall на сервере
# 4. Настройте регулярные бэкапы на внешнее хранилище (S3, Backblaze)
# 5. Настройте мониторинг и алерты в Grafana
# 6. Включите Fail2ban для защиты от брутфорса
# 7. Используйте CDN для статических файлов (Cloudflare, Fastly)
# 8. Настройте логирование в внешнюю систему (ELK, Datadog, CloudWatch)
# 9. Регулярно обновляйте Docker образы (security patches)
# 10. Используйте SSL/TLS только версий 1.2+ (отключите 1.0, 1.1)
# 11. Настройте HTTP/2 и HSTS заголовки
# 12. Включите сжатие gzip/brotli для статики
# 13. Настройте rate limiting для API endpoints
# 14. Используйте Docker secrets вместо переменных окружения для паролей
# 15. Регулярно проверяйте логи безопасности (Fail2ban, nginx access)

# ============================================================================
# ПРОИЗВОДИТЕЛЬНОСТЬ PRODUCTION
# ============================================================================
# 1. Настройте HTTP кэширование (nginx fastcgi_cache)
# 2. Используйте Redis для сессий PHP
# 3. Включите Битрикс составной кэш
# 4. Настройте CDN для upload директории
# 5. Оптимизируйте изображения (WebP, сжатие)
# 6. Используйте lazy loading для изображений
# 7. Минифицируйте CSS/JS
# 8. Настройте browser caching (expires headers)
# 9. Используйте HTTP/2 Server Push для критичных ресурсов
# 10. Настройте connection pooling для БД
