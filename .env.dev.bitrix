# ============================================================================
# BITRIX DOCKER - DEVELOPMENT ENVIRONMENT
# Разработческий сервер (shared dev server)
# ============================================================================

# ============================================================================
# ОСНОВНЫЕ НАСТРОЙКИ
# ============================================================================
COMPOSE_PROJECT_NAME=bitrix
ENVIRONMENT=dev
DEBUG=1
TZ=Europe/Moscow

# Домен для dev сервера
DOMAIN=dev.bitrix.com
EMAIL=devops@bitrix.com

# ============================================================================
# PHP НАСТРОЙКИ
# ============================================================================
PHP_VERSION=8.3

# PHP-FPM Pool настройки (для dev - средняя нагрузка)
PHP_FPM_PM=dynamic
PHP_FPM_MAX_CHILDREN=30
PHP_FPM_START_SERVERS=5
PHP_FPM_MIN_SPARE_SERVERS=3
PHP_FPM_MAX_SPARE_SERVERS=15

# PHP лимиты (для dev - чуть меньше чем local)
PHP_MEMORY_LIMIT=384M
PHP_UPLOAD_MAX_FILESIZE=64M
PHP_POST_MAX_SIZE=64M
PHP_MAX_EXECUTION_TIME=300
PHP_MAX_INPUT_TIME=300

# OPcache (для dev - включен но с валидацией каждые 60 сек)
PHP_OPCACHE_ENABLE=1
PHP_OPCACHE_MEMORY=256
PHP_OPCACHE_MAX_FILES=15000

# ============================================================================
# ПОЛЬЗОВАТЕЛЬ И ГРУППА
# ============================================================================
UID=1000
GID=1000
UGN=bitrix

# ============================================================================
# СЕТЕВЫЕ НАСТРОЙКИ
# ============================================================================
DOCKER_SUBNET=172.20.0.0/16

# Порты
HTTP_PORT=80
HTTPS_PORT=443

# ============================================================================
# MYSQL - БАЗА ДАННЫХ
# ============================================================================
DB_HOST=mysql
DB_PORT=3306
DB_NAME=bitrix_dev
DB_USERNAME=bitrix
DB_PASSWORD=CHANGE_ME_bitrix_dev_strong_password_123
DB_ROOT_PASSWORD=CHANGE_ME_root_dev_strong_password_456

# MySQL настройки (для dev - средние ресурсы)
MYSQL_INNODB_BUFFER_POOL_SIZE=1G
MYSQL_MAX_CONNECTIONS=150
MYSQL_MEMORY_LIMIT=2G
MYSQL_MEMORY_RESERVATION=1G

# ============================================================================
# REDIS - КЭШИРОВАНИЕ
# ============================================================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=CHANGE_ME_redis_dev_strong_password
REDIS_MAX_MEMORY=512mb

# ============================================================================
# MEMCACHED - ДОПОЛНИТЕЛЬНОЕ КЭШИРОВАНИЕ
# ============================================================================
MEMCACHED_HOST=memcached
MEMCACHED_PORT=11211
MEMCACHED_MEMORY_LIMIT=256
MEMCACHED_THREADS=4
MEMCACHED_CONN_LIMIT=1024

# ============================================================================
# RABBITMQ - ОЧЕРЕДИ (опционально)
# ============================================================================
RABBITMQ_HOST=amqp
RABBIT_PORT=5672
RABBIT_UI_PORT=15672
RABBIT_COOKIE=CHANGE_ME_dev_rabbitmq_cookie_strong_random_string
RABBITMQ_DEFAULT_USER=rabbitmq
RABBITMQ_DEFAULT_PASS=CHANGE_ME_rabbitmq_dev_strong_password
RABBITMQ_DEFAULT_VHOST=/

# ============================================================================
# MAILHOG - ПЕРЕХВАТ ПОЧТЫ
# ============================================================================
MAILHOG_PORT=1025
MAILHOG_WEB_PORT=8025

# ============================================================================
# SSL НАСТРОЙКИ
# ============================================================================
# 1 = self-signed, 2 = Let's Encrypt (для dev лучше Let's Encrypt)
SSL=2

# ============================================================================
# NGINX КОНФИГУРАЦИЯ
# ============================================================================
MAIL_CONFIG=1
RABBIT_CONFIG=1
DOLLAR=$

# ============================================================================
# BITRIX НАСТРОЙКИ
# ============================================================================
BITRIX_VM_VER=9.0.0

# ============================================================================
# PUSH SERVER - REAL-TIME NOTIFICATIONS
# ============================================================================
PUSH_SERVER_KEY=CHANGE_ME_push_server_security_key
PUSH_PUB_PORT=9010
PUSH_SUB_PORT=8010

# ============================================================================
# МОНИТОРИНГ И ЛОГИРОВАНИЕ
# ============================================================================
GRAFANA_PORT=3000
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_grafana_dev_password

PROMETHEUS_PORT=9090

# ============================================================================
# БЭКАПЫ
# ============================================================================
BACKUP_SCHEDULE_DB=0 2 * * *
BACKUP_SCHEDULE_FILES=0 3 * * *
BACKUP_RETENTION_DAYS=14

# ============================================================================
# PORTAINER AGENT
# ============================================================================
PORTAINER_PORT=9001
PORTAINER_AGENT_SECRET=CHANGE_ME_portainer_dev_secret

# ============================================================================
# БЕЗОПАСНОСТЬ
# ============================================================================
# Для dev окружения включаем Fail2ban
COMPOSE_PROFILES=dev,monitoring,security
