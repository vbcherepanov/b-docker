# üîí Security Scanning –¥–ª—è Bitrix Docker

–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Bitrix CMS —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è](#–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã-—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
- [–¢–∏–ø—ã –ø—Ä–æ–≤–µ—Ä–æ–∫](#—Ç–∏–ø—ã-–ø—Ä–æ–≤–µ—Ä–æ–∫)
- [–û—Ç—á–µ—Ç—ã](#–æ—Ç—á–µ—Ç—ã)
- [–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤](#–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
- [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–ø–æ-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Bitrix –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã

```bash
docker compose -f docker-compose.bitrix.yml --profile local up -d
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±—ã—Å—Ç—Ä–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (5-10 –º–∏–Ω—É—Ç)

```bash
./security-scan.sh quick
```

### 3. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –æ—Ç—á–µ—Ç—ã

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ —Å–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ
open security-reports/summary-*.html

# –ò–ª–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ Bitrix-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
cat security-reports/bitrix-security.txt
```

## üõ† –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

### OWASP ZAP
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- XSS (Cross-Site Scripting)
- SQL Injection
- CSRF (Cross-Site Request Forgery)
- –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏
- –£—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ —Ñ–æ—Ä–º–∞—Ö –∏ cookie
- –ü—Ä–æ–±–ª–µ–º—ã —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

**–†–µ–∂–∏–º—ã:**
- `quick` - Baseline scan (~5 –º–∏–Ω)
- `full` - Full scan (~20-30 –º–∏–Ω)
- API scan - –¥–ª—è REST API Bitrix

### Nikto
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx
- –ò–∑–≤–µ—Å—Ç–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
- –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –≤–µ—Ä—Å–∏–∏ –ü–û
- HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### TestSSL.sh
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –ö–∞—á–µ—Å—Ç–≤–æ SSL/TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- –°–ª–∞–±—ã–µ —à–∏—Ñ—Ä—ã –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã
- SSL —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (POODLE, Heartbleed –∏ –¥—Ä.)
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è HTTPS

### Trivy
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- CVE –≤ Docker –æ–±—Ä–∞–∑–∞—Ö
- –£—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–∞–∫–µ—Ç–∞—Ö
- –ü—Ä–æ–±–ª–µ–º—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
- –°–µ–∫—Ä–µ—Ç—ã –≤ –æ–±—Ä–∞–∑–∞—Ö

### Bitrix Security Check
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫—Ä–∏—Ç–∏—á–Ω—ã–º —Ñ–∞–π–ª–∞–º
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ .settings.php
- PHP —Ñ–∞–π–ª—ã –≤ upload –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- –ó–∞—â–∏—Ç–∞ /bitrix/admin/
- –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ Composer –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –≤ –≤–µ–±-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–µ —Ñ–∞–π–ª—ã

## üìä –¢–∏–ø—ã –ø—Ä–æ–≤–µ—Ä–æ–∫

### –ë—ã—Å—Ç—Ä–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (~5-10 –º–∏–Ω—É—Ç)

```bash
./security-scan.sh quick
```

**–í–∫–ª—é—á–∞–µ—Ç:**
- ‚úÖ OWASP ZAP Baseline
- ‚úÖ Nikto scan
- ‚úÖ Bitrix Security Check

**–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:** —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫, CI/CD

### –ü–æ–ª–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (~30-60 –º–∏–Ω—É—Ç)

```bash
./security-scan.sh full
```

**–í–∫–ª—é—á–∞–µ—Ç:**
- ‚úÖ OWASP ZAP Full Scan
- ‚úÖ OWASP ZAP API Scan
- ‚úÖ Nikto scan
- ‚úÖ TestSSL.sh
- ‚úÖ Trivy
- ‚úÖ Bitrix Security Check

**–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:** –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞, –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –≤ production

## üìù –û—Ç—á–µ—Ç—ã

–í—Å–µ –æ—Ç—á–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `security-reports/`:

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `zap-baseline-report.html` | OWASP ZAP –±–∞–∑–æ–≤–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `zap-full-report.html` | OWASP ZAP –ø–æ–ª–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `nikto-report.html` | Nikto —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ |
| `testssl-report.html` | SSL/TLS –ø—Ä–æ–≤–µ—Ä–∫–∞ |
| `trivy-report.json` | –£—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ Docker –æ–±—Ä–∞–∑–∞—Ö |
| `bitrix-security.txt` | Bitrix-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ |
| `summary-[date].html` | –°–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç —Å–æ –≤—Å–µ–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ |

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–≤–æ–¥–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞

```bash
./security-scan.sh report
```

## üéØ –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –£—Ä–æ–≤–Ω–∏ —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏

| –£—Ä–æ–≤–µ–Ω—å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–µ–π—Å—Ç–≤–∏—è |
|---------|----------|----------|
| **Critical** üî¥ | –ö—Ä–∏—Ç–∏—á–Ω–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å | –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ |
| **High** üü† | –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ | –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏ |
| **Medium** üü° | –°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫ | –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ |
| **Low** üü¢ | –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫ | –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ |
| **Info** ‚ÑπÔ∏è | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è | –î–ª—è —Å–ø—Ä–∞–≤–∫–∏ |

### Bitrix Security Check - –∫–æ–¥—ã –≤—ã—Ö–æ–¥–∞

- `0` - ‚úÖ –•–æ—Ä–æ—à–æ (–Ω–∞–π–¥–µ–Ω–æ <5 –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π)
- `0` - ‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç—Å—è —É–ª—É—á—à–µ–Ω–∏—è (>5 –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π)
- `1` - ‚ùå –ö—Ä–∏—Ç–∏—á–Ω–æ (–Ω–∞–π–¥–µ–Ω—ã –æ—à–∏–±–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)

## üõ°Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã

1. **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ debug mode –≤ production**
   ```php
   // .settings.php
   'debug' => false
   ```

2. **–ó–∞—â–∏—Ç–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—É—é —á–∞—Å—Ç—å**
   - HTTP Basic Auth –¥–ª—è /bitrix/admin/
   - IP restrictions
   - –°–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏

3. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º**
   ```bash
   chmod 600 bitrix/.settings.php
   chmod 600 bitrix/php_interface/dbconn.php
   ```

4. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ PHP –≤ upload**
   - Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–µ—Ç PHP —Ñ–∞–π–ª–æ–≤ –≤ /upload/

5. **–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**
   - Bitrix CMS
   - PHP
   - Composer –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
   - Docker –æ–±—Ä–∞–∑—ã

### HTTP Security Headers

–î–æ–±–∞–≤—å—Ç–µ –≤ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```nginx
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;
add_header Content-Security-Policy "default-src 'self' 'unsafe-inline' 'unsafe-eval' https: data:;" always;
```

### SSL/TLS Best Practices

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ TLS 1.2 –∏ –≤—ã—à–µ
2. –û—Ç–∫–ª—é—á–∏—Ç–µ —Å–ª–∞–±—ã–µ —à–∏—Ñ—Ä—ã
3. –í–∫–ª—é—á–∏—Ç–µ HSTS
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Let's Encrypt –∏–ª–∏ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

## üîß –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–∫–∞–Ω–µ—Ä–æ–≤

```bash
# –¢–æ–ª—å–∫–æ OWASP ZAP
docker compose -f docker-compose.security.yml run --rm owasp-zap-baseline

# –¢–æ–ª—å–∫–æ Nikto
docker compose -f docker-compose.security.yml run --rm nikto

# –¢–æ–ª—å–∫–æ Bitrix check
docker compose -f docker-compose.security.yml run --rm bitrix-security-check
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ CI/CD

–î–æ–±–∞–≤—å—Ç–µ –≤ `.github/workflows/security.yml`:

```yaml
name: Security Scan

on:
  schedule:
    - cron: '0 2 * * 0'  # –ö–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 2:00
  workflow_dispatch:

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Run security scan
        run: ./security-scan.sh quick
      - name: Upload reports
        uses: actions/upload-artifact@v2
        with:
          name: security-reports
          path: security-reports/
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π:

1. –ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ –¥–µ—Ç–∞–ª–∏ –ø—É–±–ª–∏—á–Ω–æ
2. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ hotfix
3. –û–±–Ω–æ–≤–∏—Ç–µ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
4. –ü–µ—Ä–µ—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –û—Ç—á–µ—Ç—ã –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ.
–ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ –∏—Ö –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –¥–æ—Å—Ç—É–ø–µ –∏ –¥–æ–±–∞–≤—å—Ç–µ `security-reports/` –≤ `.gitignore`.
