# ะกะบัะธะฟัั ะฑะตะทะพะฟะฐัะฝะพััะธ Bitrix CMS

ะะฐะฑะพั ัะบัะธะฟัะพะฒ ะดะปั ะบะพะผะฟะปะตะบัะฝะพะน ะฟัะพะฒะตัะบะธ ะฑะตะทะพะฟะฐัะฝะพััะธ Bitrix CMS ะพะบััะถะตะฝะธั.

## ะกะพะดะตัะถะฐะฝะธะต

- [comprehensive-security-audit.sh](#comprehensive-security-auditsh) - ะะพะปะฝัะน ะฐัะดะธั ะฑะตะทะพะฟะฐัะฝะพััะธ (ะฒะฝะตัะฝะธะน + ะฒะฝัััะตะฝะฝะธะน)
- [bitrix-security-check.sh](#bitrix-security-checksh) - ะัะพะฒะตัะบะฐ Bitrix ัะฐะนะปะพะฒ ะธ ะบะพะฝัะธะณััะฐัะธะธ

---

## comprehensive-security-audit.sh

### ะะฟะธัะฐะฝะธะต

**ะะพะผะฟะปะตะบัะฝัะน ัะบัะธะฟั** ะดะปั ะฟะพะปะฝะพะน ะฟัะพะฒะตัะบะธ ะฑะตะทะพะฟะฐัะฝะพััะธ Bitrix ัะฐะนัะฐ ั ะฒะฝะตัะฝะธะผ ะธ ะฒะฝัััะตะฝะฝะธะผ ัะบะฐะฝะธัะพะฒะฐะฝะธะตะผ.

### ะงัะพ ะฟัะพะฒะตััะตั

#### 1. ะกะบะฐะฝะธัะพะฒะฐะฝะธะต ะพัะบััััั ะฟะพััะพะฒ
- โ ะัะพะฒะตัะบะฐ ะดะพัััะฟะฝะพััะธ HTTP (80) ะธ HTTPS (443)
- โ ะะฑะฝะฐััะถะตะฝะธะต ะพัะบััััั ะพะฟะฐัะฝัั ะฟะพััะพะฒ (MySQL 3306, PostgreSQL 5432, Redis 6379, Memcached 11211, MongoDB 27017, Elasticsearch 9200, etc.)
- ๐ฅ ะัะพะฒะตัะบะฐ ััะฐัััะฐ Firewall (firewalld/ufw)

#### 2. SSL/TLS ัะตััะธัะธะบะฐัั ะธ ัะธััะพะฒะฐะฝะธะต
- ๐ ะัะพะฒะตัะบะฐ ะฝะฐะปะธัะธั ะธ ะฒะฐะปะธะดะฝะพััะธ SSL ัะตััะธัะธะบะฐัะฐ
- โฐ ะกัะพะบ ะดะตะนััะฒะธั ัะตััะธัะธะบะฐัะฐ (ะฟัะตะดัะฟัะตะถะดะตะฝะธะต ะตัะปะธ < 30 ะดะฝะตะน)
- ๐ ะะตััะธั TLS ะฟัะพัะพะบะพะปะฐ (ะดะพะปะถะตะฝ ะฑััั TLSv1.2 ะธะปะธ TLSv1.3)
- ๐ซ ะะฑะฝะฐััะถะตะฝะธะต ัะปะฐะฑัั ัะธััะพะฒ (NULL, EXPORT, DES)
- โช๏ธ ะัะพะฒะตัะบะฐ HTTP -> HTTPS ัะตะดะธัะตะบัะฐ

#### 3. HTTP ะทะฐะณะพะปะพะฒะบะธ ะฑะตะทะพะฟะฐัะฝะพััะธ
- `X-Frame-Options` - ะทะฐัะธัะฐ ะพั clickjacking
- `X-Content-Type-Options: nosniff` - ะทะฐัะธัะฐ ะพั MIME sniffing
- `Strict-Transport-Security` (HSTS) - ะฟัะธะฝัะดะธัะตะปัะฝัะน HTTPS
- `Content-Security-Policy` - ะทะฐัะธัะฐ ะพั XSS
- `X-XSS-Protection` - ะดะพะฟะพะปะฝะธัะตะปัะฝะฐั XSS ะทะฐัะธัะฐ
- `Referrer-Policy` - ะบะพะฝััะพะปั referrer
- `Permissions-Policy` - ัะฐะทัะตัะตะฝะธั ะฑัะฐัะทะตัะฐ
- ะัะพะฒะตัะบะฐ ััะตัะบะธ ะฒะตััะธะน ัะตัะฒะตัะฐ (`Server`, `X-Powered-By`)

#### 4. ะกะบะฐะฝะธัะพะฒะฐะฝะธะต ะฒะตะฑ-ััะทะฒะธะผะพััะตะน
- ๐ ะัะพะฒะตัะบะฐ ะดะพัััะฟะฝะพััะธ ะพะฟะฐัะฝัั ัะฐะนะปะพะฒ:
  - `phpinfo.php`, `info.php`, `test.php`
  - `.git/config`, `.svn/entries`
  - `.env`, `composer.json`, `package.json`
  - Backup ัะฐะนะปั (`*.sql`, `dump.sql`, `*.bak`)
  - Bitrix ะบะพะฝัะธะณััะฐัะธั (`dbconn.php`)
- ๐ Directory listing (ะฐะฒัะพะธะฝะดะตะบั ะดะธัะตะบัะพัะธะน)
- ๐ ะะฐะทะพะฒะฐั ะฟัะพะฒะตัะบะฐ SQL injection
- ๐ฏ ะะฐะทะพะฒะฐั ะฟัะพะฒะตัะบะฐ XSS

#### 5. PHP ะฝะฐัััะพะนะบะธ ะฑะตะทะพะฟะฐัะฝะพััะธ
- `display_errors` - ะดะพะปะถะตะฝ ะฑััั OFF
- `expose_php` - ะดะพะปะถะตะฝ ะฑััั OFF
- `allow_url_fopen` - ะฟัะพะฒะตัะบะฐ ัะพััะพัะฝะธั
- `allow_url_include` - ะดะพะปะถะตะฝ ะฑััั OFF (ะบัะธัะธัะฝะพ!)
- `disable_functions` - ะพะฟะฐัะฝัะต ััะฝะบัะธะธ ะดะพะปะถะฝั ะฑััั ะพัะบะปััะตะฝั
- `open_basedir` - ะธะทะพะปััะธั ะฟััะตะน
- `session.cookie_httponly` - ะทะฐัะธัะฐ ะพั XSS
- `session.cookie_secure` - ัะพะปัะบะพ HTTPS

#### 6. MySQL/MariaDB ะฑะตะทะพะฟะฐัะฝะพััั
- ๐ ะัะพะฒะตัะบะฐ ะดะพัััะฟะฐ ะฑะตะท ะฟะฐัะพะปั
- ๐ ะัะพะฒะตัะบะฐ ัะดะฐะปะตะฝะฝะพะณะพ ะดะพัััะฟะฐ (ะฝะต ะดะพะปะถะตะฝ ัะปััะฐัั 0.0.0.0)

#### 7. Nginx/Apache ะบะพะฝัะธะณััะฐัะธั
- ะะตััะธั ะฒะตะฑ-ัะตัะฒะตัะฐ
- `server_tokens` (nginx) - ัะบัััะธะต ะฒะตััะธะธ
- `client_max_body_size` - ะปะธะผะธั ะทะฐะณััะทะบะธ
- `mod_security` (Apache) - WAF

#### 8. Bitrix ัะฟะตัะธัะธัะฝัะต ัะฐะนะปั
- ะัะฐะฒะฐ ะดะพัััะฟะฐ `.settings.php` (ะดะพะปะถะฝะพ ะฑััั 600/640)
- ะัะฐะฒะฐ ะดะพัััะฟะฐ `dbconn.php` (ะดะพะปะถะฝะพ ะฑััั 600/640)
- Debug mode ะฒ `.settings.php`
- PHP ัะฐะนะปั ะฒ `/upload` (ะบัะธัะธัะตัะบะฐั ััะทะฒะธะผะพััั!)
- ะะตะทะตัะฒะฝัะต ะบะพะฟะธะธ ะฒ ะฒะตะฑ-ะดะธัะตะบัะพัะธะธ
- `.git` ะดะธัะตะบัะพัะธั ะฒ ะฒะตะฑ-ะบะพัะฝะต

#### 9. ะกะธััะตะผะฝัะต ะพะฑะฝะพะฒะปะตะฝะธั
- ะะพัััะฟะฝะพััั ะพะฑะฝะพะฒะปะตะฝะธะน ะฟะฐะบะตัะพะฒ (YUM/APT)

#### 10. Docker ะบะพะฝัะตะนะฝะตัั (ะพะฟัะธะพะฝะฐะปัะฝะพ, ั ัะปะฐะณะพะผ --docker)
- ๐ณ **ะะฐะฟััะบ ะบะพะฝัะตะนะฝะตัะพะฒ:**
  - ะะฐะฟััะบ ะพั root (ัะตะบะพะผะตะฝะดัะตััั non-root)
  - Privileged ัะตะถะธะผ (ะบัะธัะธัะตัะบะฐั ััะทะฒะธะผะพััั!)
  - Read-only ัะฐะนะปะพะฒะฐั ัะธััะตะผะฐ
- ๐ **ะกะตัั ะธ ะฟะพััั:**
  - ะัะพะฑัะพัะตะฝะฝัะต ะฟะพััั
  - ะะฟะฐัะฝัะต ะฟะพััั ะะ/ะบััะฐ ะดะพัััะฟะฝัะต ะธะทะฒะฝะต
- ๐ **Capabilities ะธ Security:**
  - ะะฟะฐัะฝัะต capabilities (SYS_ADMIN, NET_ADMIN)
  - Seccomp / AppArmor ะฟัะพัะธะปะธ
  - ะะพัััะฟ ะบ Docker socket (ะบัะธัะธัะตัะบะฐั ััะทะฒะธะผะพััั!)
- ๐พ **ะะตััััั:**
  - ะะธะผะธัั ะฟะฐะผััะธ ะธ CPU
  - Health checks
  - ะะพะฝัะธัะพะฒะฐะฝะฝัะต ัะพะผะฐ (ัะธััะตะผะฝัะต ะดะธัะตะบัะพัะธะธ)
- ๐ก๏ธ **Docker daemon:**
  - User namespace remapping
  - Docker Content Trust
  - ะะตะธัะฟะพะปัะทัะตะผัะต ะพะฑัะฐะทั ะธ ะบะพะฝัะตะนะฝะตัั
- ๐ฆ **Docker Compose:**
  - Hardcoded ะฟะฐัะพะปะธ ะฒ docker-compose.yml
- ๐ **ะกะบะฐะฝะธัะพะฒะฐะฝะธะต ะพะฑัะฐะทะพะฒ:**
  - Trivy ัะบะฐะฝะตั (ะตัะปะธ ัััะฐะฝะพะฒะปะตะฝ)

---

### ะัะฟะพะปัะทะพะฒะฐะฝะธะต

#### ะะฐ ัะตัะฒะตัะต ั Docker

```bash
# ะะฐะทะพะฒัะน ะทะฐะฟััะบ (ะดะปั localhost, ะฑะตะท Docker ะฟัะพะฒะตัะพะบ)
./security-scripts/comprehensive-security-audit.sh

# ะก ัะบะฐะทะฐะฝะธะตะผ ะดะพะผะตะฝะฐ
./security-scripts/comprehensive-security-audit.sh --domain example.com

# ะก ะฟัะพะฒะตัะบะพะน Docker ะบะพะฝัะตะนะฝะตัะพะฒ
./security-scripts/comprehensive-security-audit.sh --docker --domain example.com

# ะะพะปะฝะฐั ะฝะฐัััะพะนะบะฐ ั ะฐัะณัะผะตะฝัะฐะผะธ
./security-scripts/comprehensive-security-audit.sh \
  --docker \
  --domain example.com \
  --app-dir /var/www/html

# ะะปะธ ัะตัะตะท ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
DOMAIN="example.com" \
CHECK_DOCKER="true" \
APP_DIR="/var/www/html" \
REPORT_DIR="/var/log/security" \
./security-scripts/comprehensive-security-audit.sh

# ะะฝัััะธ Docker ะบะพะฝัะตะนะฝะตัะฐ
docker exec bitrix_web bash -c "DOMAIN=example.com CHECK_DOCKER=true ./security-scripts/comprehensive-security-audit.sh"

# ะะพะบะฐะทะฐัั ัะฟัะฐะฒะบั
./security-scripts/comprehensive-security-audit.sh --help
```

#### ะะฐ CentOS/RHEL ะฑะตะท Docker

```bash
# ะกะบะฐัะฐัั ัะบัะธะฟั
wget https://raw.githubusercontent.com/your-repo/security-scripts/comprehensive-security-audit.sh
chmod +x comprehensive-security-audit.sh

# ะะฐะฟัััะธัั ั ะฝะฐัััะพะนะบะฐะผะธ (ัะตัะตะท ะฐัะณัะผะตะฝัั)
./comprehensive-security-audit.sh --domain example.com --app-dir /var/www/html

# ะะปะธ ัะตัะตะท ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
DOMAIN="example.com" \
APP_DIR="/var/www/html" \
REPORT_DIR="/tmp" \
./comprehensive-security-audit.sh

# ะัะปะธ Docker ัััะฐะฝะพะฒะปะตะฝ ะธ ะฝัะถะฝะพ ะฟัะพะฒะตัะธัั ะบะพะฝัะตะนะฝะตัั
./comprehensive-security-audit.sh --docker --domain example.com
```

#### ะะฒัะพะผะฐัะธะทะฐัะธั ัะตัะตะท Cron

```bash
# ะัะบัััั crontab
crontab -e

# ะะถะตะดะฝะตะฒะฝะฐั ะฟัะพะฒะตัะบะฐ ะฒ 3:00 ะฝะพัะธ (ะะะ Docker)
0 3 * * * /path/to/comprehensive-security-audit.sh --domain example.com --app-dir /var/www/html

# ะะถะตะดะฝะตะฒะฝะฐั ะฟัะพะฒะตัะบะฐ ะก Docker ะบะพะฝัะตะนะฝะตัะฐะผะธ
0 3 * * * /path/to/comprehensive-security-audit.sh --docker --domain example.com

# ะก email ัะฒะตะดะพะผะปะตะฝะธะตะผ ะฟัะธ ะบัะธัะธัะตัะบะธั ะฟัะพะฑะปะตะผะฐั
0 3 * * * /path/to/comprehensive-security-audit.sh --docker --domain example.com || mail -s "CRITICAL: Security Issues!" admin@example.com < /reports/comprehensive-security-*.txt

# ะะถะตะฝะตะดะตะปัะฝะฐั ะฟะพะปะฝะฐั ะฟัะพะฒะตัะบะฐ (ะฒะพัะบัะตัะตะฝัะต, 2:00) ั Docker
0 2 * * 0 CHECK_DOCKER=true DOMAIN="example.com" /path/to/comprehensive-security-audit.sh
```

---

### ะะฐัะฐะผะตััั

#### ะัะณัะผะตะฝัั ะบะพะผะฐะฝะดะฝะพะน ัััะพะบะธ

| ะัะณัะผะตะฝั | ะะฟะธัะฐะฝะธะต |
|----------|----------|
| `--docker` | ะะบะปััะธัั ะฟัะพะฒะตัะบั Docker ะบะพะฝัะตะนะฝะตัะพะฒ |
| `--domain DOMAIN` | ะะพะผะตะฝ ะดะปั ะฟัะพะฒะตัะบะธ (ะฟะพ ัะผะพะปัะฐะฝะธั: localhost) |
| `--app-dir DIR` | ะะธัะตะบัะพัะธั ะฟัะธะปะพะถะตะฝะธั (ะฟะพ ัะผะพะปัะฐะฝะธั: /app) |
| `--help` | ะะพะบะฐะทะฐัั ัะฟัะฐะฒะบั |

#### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

| ะะตัะตะผะตะฝะฝะฐั | ะะฟะธัะฐะฝะธะต | ะะพ ัะผะพะปัะฐะฝะธั |
|-----------|----------|--------------|
| `DOMAIN` | ะะพะผะตะฝ ะดะปั ะฟัะพะฒะตัะบะธ | `localhost` |
| `APP_DIR` | ะััั ะบ Bitrix ะดะธัะตะบัะพัะธะธ | `/app` |
| `REPORT_DIR` | ะะธัะตะบัะพัะธั ะดะปั ะพััะตัะพะฒ | `/reports` |
| `CHECK_DOCKER` | ะัะพะฒะตัััั Docker (true/false) | `false` |

---

### ะคะพัะผะฐั ะพััะตัะฐ

ะกะบัะธะฟั ะณะตะฝะตัะธััะตั ะดะตัะฐะปัะฝัะน ัะตะบััะพะฒัะน ะพััะตั ั:

```
โ ะัะพะนะดะตะฝะพ ััะฟะตัะฝะพ
โ WARNING: ะัะตะดัะฟัะตะถะดะตะฝะธั
โ ERROR: ะัะธะฑะบะธ
โ CRITICAL: ะัะธัะธัะตัะบะธะต ะฟัะพะฑะปะตะผั
โน ะะฝัะพัะผะฐัะธั
```

**ะัะพะณะพะฒัะน ะพััะตั ะฒะบะปััะฐะตั:**
- ะะฑัะตะต ะบะพะปะธัะตััะฒะพ ะฟัะพะฒะตัะพะบ
- ะัะพัะตะฝั ััะฟะตัะฝัั ะฟัะพะฒะตัะพะบ
- ะกัะตััะธะบะธ ะฟะพ ะบะฐัะตะณะพัะธัะผ
- ะะฑัะธะน ะฑะฐะปะป ะฑะตะทะพะฟะฐัะฝะพััะธ (%)
- ะคะธะฝะฐะปัะฝัะน ััะฐััั

**ะกัะฐัััั:**
- โ **ะะขะะะงะะ** - ะฝะตั ะฟัะพะฑะปะตะผ
- โก **ะฅะะะะจะ** - ะตััั ะฝะตะฑะพะปััะธะต ัะตะบะพะผะตะฝะดะฐัะธะธ
- โ **ะขะะะะฃะฎะขะกะฏ ะฃะะฃะงะจะะะะฏ** - ะผะฝะพะณะพ ะฟัะตะดัะฟัะตะถะดะตะฝะธะน (>10)
- โ **ะกะะะฌะะะะซะ ะะะะะะะะซ** - ะฝะฐะนะดะตะฝั ะพัะธะฑะบะธ
- โ **ะะะะขะะงะะกะะะ ะะะะะะะะซ** - ััะตะฑัะตััั ะฝะตะผะตะดะปะตะฝะฝะพะต ะธัะฟัะฐะฒะปะตะฝะธะต

---

### Exit ะบะพะดั

- `0` - ะัะพะฒะตัะบะฐ ะฟัะพะนะดะตะฝะฐ ััะฟะตัะฝะพ ะธะปะธ ั ะฟัะตะดัะฟัะตะถะดะตะฝะธัะผะธ
- `1` - ะะฑะฝะฐััะถะตะฝั ะพัะธะฑะบะธ (ERRORS)
- `2` - ะะฑะฝะฐััะถะตะฝั ะบัะธัะธัะตัะบะธะต ะฟัะพะฑะปะตะผั (CRITICAL)

---

### ะัะธะผะตั ะฒัะฒะพะดะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  COMPREHENSIVE BITRIX SECURITY AUDIT                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ะะฐัะฐ ะฟัะพะฒะตัะบะธ: 2025-01-15 14:30:00
ะัะพะฒะตััะตะผัะน ะดะพะผะตะฝ: example.com
ะะธัะตะบัะพัะธั ะฟัะธะปะพะถะตะฝะธั: /var/www/html
ะััะตั: /reports/comprehensive-security-audit-20250115-143000.txt

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
1. ะกะะะะะะะะะะะ ะะขะะะซะขะซะฅ ะะะะขะะ ะ ะกะะขะะะะ ะะะะะะะกะะะกะขะ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โน ะกะบะฐะฝะธัะพะฒะฐะฝะธะต ะฟะพััะพะฒ ะฝะฐ example.com...
โ ะะพัั 80 ะพัะบััั (HTTP/HTTPS)
โ ะะพัั 443 ะพัะบััั (HTTP/HTTPS)
โ ะะพัั 3306 ะทะฐะบััั (ะฑะตะทะพะฟะฐัะฝะพ)
โ Firewall ะฐะบัะธะฒะตะฝ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
2. ะะะะะะะะ SSL/TLS ะกะะะขะะคะะะะขะะ ะ ะจะะคะะะะะะะฏ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โน ะัะพะฒะตัะบะฐ SSL ัะตััะธัะธะบะฐัะฐ ะดะปั example.com...
โ SSL/TLS ัะพะตะดะธะฝะตะฝะธะต ัััะฐะฝะพะฒะปะตะฝะพ
โ ะัะฟะพะปัะทัะตััั ะฑะตะทะพะฟะฐัะฝัะน ะฟัะพัะพะบะพะป: TLSv1.3
โ ะกะปะฐะฑัะต ัะธััั ะฝะต ะพะฑะฝะฐััะถะตะฝั
โ WARNING: SSL ัะตััะธัะธะบะฐั ะธััะตะบะฐะตั ัะตัะตะท 25 ะดะฝะตะน

...

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
10. ะะขะะะะะซะ ะะขะงะะข
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ะัะตะณะพ ะฟัะพะฒะตัะพะบ ะฒัะฟะพะปะฝะตะฝะพ: 58
โ ะัะพะนะดะตะฝะพ ััะฟะตัะฝะพ: 52
โ ะัะตะดัะฟัะตะถะดะตะฝะธะน: 6
โ ะัะธะฑะพะบ: 0
โ ะัะธัะธัะตัะบะธั ะฟัะพะฑะปะตะผ: 0

ะะฑัะธะน ะฑะฐะปะป ะฑะตะทะพะฟะฐัะฝะพััะธ: 89.7%

โก ะกะขะะขะฃะก: ะฅะะะะจะ (ะตััั ัะตะบะพะผะตะฝะดะฐัะธะธ)
ะกะธััะตะผะฐ ะฒ ัะตะปะพะผ ะฑะตะทะพะฟะฐัะฝะฐ, ะฝะพ ะตััั ะผะพะผะตะฝัั ะดะปั ัะปัััะตะฝะธั
```

---

### ะขัะตะฑะพะฒะฐะฝะธั

#### ะะฑัะทะฐัะตะปัะฝัะต ััะธะปะธัั:
- `bash` (4.0+)
- `curl`
- `grep`, `awk`, `sed`

#### ะะฟัะธะพะฝะฐะปัะฝัะต (ะดะปั ัะฐััะธัะตะฝะฝัั ะฟัะพะฒะตัะพะบ):
- `nc` (netcat) ะธะปะธ `telnet` - ัะบะฐะฝะธัะพะฒะฐะฝะธะต ะฟะพััะพะฒ
- `openssl` - ะฟัะพะฒะตัะบะฐ SSL/TLS
- `php` - ะฟัะพะฒะตัะบะฐ PHP ะฝะฐัััะพะตะบ
- `mysql` - ะฟัะพะฒะตัะบะฐ ะะ
- `nginx`/`apache2`/`httpd` - ะฟัะพะฒะตัะบะฐ ะฒะตะฑ-ัะตัะฒะตัะฐ
- `firewall-cmd` ะธะปะธ `ufw` - ะฟัะพะฒะตัะบะฐ firewall
- `yum` ะธะปะธ `apt` - ะฟัะพะฒะตัะบะฐ ะพะฑะฝะพะฒะปะตะฝะธะน
- `docker` - ะฟัะพะฒะตัะบะฐ Docker ะบะพะฝัะตะนะฝะตัะพะฒ (ัะพะปัะบะพ ะฟัะธ --docker)
- `trivy` - ัะบะฐะฝะธัะพะฒะฐะฝะธะต Docker ะพะฑัะฐะทะพะฒ ะฝะฐ ััะทะฒะธะผะพััะธ (ะพะฟัะธะพะฝะฐะปัะฝะพ)

---

## bitrix-security-check.sh

### ะะฟะธัะฐะฝะธะต

ะัะธะณะธะฝะฐะปัะฝัะน ัะบัะธะฟั ะดะปั ะฟัะพะฒะตัะบะธ **ะฒะฝัััะตะฝะฝะธั** Bitrix ัะฐะนะปะพะฒ ะธ ะบะพะฝัะธะณััะฐัะธะธ.

### ะงัะพ ะฟัะพะฒะตััะตั

1. ะัะฐะฒะฐ ะดะพัััะฟะฐ ะบ `.settings.php` ะธ `dbconn.php`
2. PHP ัะฐะนะปั ะฒ `/upload`
3. Debug mode ะฒ `.settings.php`
4. HTTP Basic Auth ะดะปั `/bitrix/admin`
5. Composer ะทะฐะฒะธัะธะผะพััะธ
6. ะฃัะทะฒะธะผัะต ัะฐะนะปั
7. ะะตะทะตัะฒะฝัะต ะบะพะฟะธะธ ะฒ ะฒะตะฑ-ะดะธัะตะบัะพัะธะธ
8. ะัะตะผะตะฝะฝัะต ัะฐะนะปั
9. ะะฐะทะผะตั upload ะดะธัะตะบัะพัะธะธ

### ะัะฟะพะปัะทะพะฒะฐะฝะธะต

```bash
# ะะฐะทะพะฒัะน ะทะฐะฟััะบ
./security-scripts/bitrix-security-check.sh

# ะก ะฝะฐัััะพะนะบะฐะผะธ
APP_DIR="/var/www/html" \
REPORT_FILE="/tmp/bitrix-security.txt" \
./security-scripts/bitrix-security-check.sh

# ะัะพัะผะพัั ะพััะตัะฐ
cat /reports/bitrix-security.txt
```

---

## ะะฝัะตะณัะฐัะธั ะฒ CI/CD

### GitLab CI

```yaml
security_audit:
  stage: test
  script:
    - DOMAIN="staging.example.com" ./security-scripts/comprehensive-security-audit.sh
  artifacts:
    reports:
      junit: /reports/comprehensive-security-*.txt
    when: always
  allow_failure: false
```

### GitHub Actions

```yaml
name: Security Audit

on:
  schedule:
    - cron: '0 3 * * *'  # ะะถะตะดะฝะตะฒะฝะพ ะฒ 3:00
  push:
    branches: [ main ]

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Run Security Audit
        run: |
          DOMAIN="${{ secrets.DOMAIN }}" \
          ./security-scripts/comprehensive-security-audit.sh
      - name: Upload Report
        uses: actions/upload-artifact@v2
        with:
          name: security-report
          path: /reports/*.txt
```

---

## ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ะฑะตะทะพะฟะฐัะฝะพััะธ

### ะัะธัะธัะตัะบะธะต ะผะพะผะตะฝัั

1. **ะะฐะบัััั ะพะฟะฐัะฝัะต ะฟะพััั** (3306, 6379, etc.) ะพั ะฒะฝะตัะฝะตะณะพ ะดะพัััะฟะฐ
2. **ะฃััะฐะฝะพะฒะธัั SSL ัะตััะธัะธะบะฐั** ะธ ะฝะฐัััะพะธัั HTTPS ัะตะดะธัะตะบั
3. **ะัะบะปััะธัั `allow_url_include`** ะฒ PHP
4. **ะฃะดะฐะปะธัั PHP ัะฐะนะปั ะธะท `/upload`**
5. **ะฃััะฐะฝะพะฒะธัั ะฟัะฐะฒะฐ 600** ะฝะฐ `.settings.php` ะธ `dbconn.php`
6. **ะัะบะปััะธัั debug mode** ะฒ production
7. **ะะพะฑะฐะฒะธัั HTTP security headers**

### Docker ะฑะตะทะพะฟะฐัะฝะพััั

1. **ะะ ะทะฐะฟััะบะฐัั ะบะพะฝัะตะนะฝะตัั ะฒ privileged ัะตะถะธะผะต**
2. **ะะ ะผะพะฝัะธัะพะฒะฐัั `/var/run/docker.sock` ะฒ ะบะพะฝัะตะนะฝะตัั**
3. **ะัะฟะพะปัะทะพะฒะฐัั non-root ะฟะพะปัะทะพะฒะฐัะตะปะตะน** ะฒ ะบะพะฝัะตะนะฝะตัะฐั
4. **ะฃััะฐะฝะพะฒะธัั ะปะธะผะธัั ะฟะฐะผััะธ ะธ CPU**
5. **ะะ ะพัะบะปััะฐัั seccomp ะธ AppArmor**
6. **ะะ ะฟัะพะฑัะฐััะฒะฐัั ะฟะพััั ะะ (3306, 6379) ะฝะฐััะถั**
7. **ะัะฟะพะปัะทะพะฒะฐัั secrets** ะฒะผะตััะพ hardcoded ะฟะฐัะพะปะตะน ะฒ docker-compose.yml
8. **ะะตะณัะปััะฝะพ ะพะฑะฝะพะฒะปััั ะพะฑัะฐะทั** ะธ ัะบะฐะฝะธัะพะฒะฐัั ะฝะฐ ััะทะฒะธะผะพััะธ (trivy)

### ะะตะณัะปััะฝัะต ะฟัะพะฒะตัะบะธ

- ะะฐะฟััะบะฐะนัะต ะบะพะผะฟะปะตะบัะฝัะน ะฐัะดะธั **ะผะธะฝะธะผัะผ ัะฐะท ะฒ ะฝะตะดะตะปั**
- ะะฐัััะพะนัะต **ะฐะฒัะพะผะฐัะธัะตัะบะธะต ัะฒะตะดะพะผะปะตะฝะธั** ะฟัะธ ะบัะธัะธัะตัะบะธั ะฟัะพะฑะปะตะผะฐั
- **ะะพะฝะธัะพัััะต ััะพะบ ะดะตะนััะฒะธั** SSL ัะตััะธัะธะบะฐัะพะฒ
- **ะะฑะฝะพะฒะปัะนัะต ัะธััะตะผั** ะธ ะทะฐะฒะธัะธะผะพััะธ ัะตะณัะปััะฝะพ

---

## ะะพะดะดะตัะถะบะฐ

ะัะธ ะพะฑะฝะฐััะถะตะฝะธะธ ะฟัะพะฑะปะตะผ ะธะปะธ ะฒะพะฟัะพัะฐั ัะพะทะดะฐะฒะฐะนัะต Issue ะฒ ัะตะฟะพะทะธัะพัะธะธ ะฟัะพะตะบัะฐ.

---

## ะะธัะตะฝะทะธั

MIT License
