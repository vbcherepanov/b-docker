; =============================================================================
; PHP SECURITY HARDENING CONFIGURATION
; =============================================================================

; --- Basic Security ---
expose_php = Off
allow_url_fopen = Off
allow_url_include = Off
enable_dl = Off

; --- Session Security ---
; session.use_strict_mode = Off for Bitrix compatibility (site_checker UserAgent test)
session.use_strict_mode = Off
session.use_only_cookies = On
session.cookie_httponly = On
session.cookie_samesite = Lax
session.use_trans_sid = Off
session.sid_length = 48
session.sid_bits_per_character = 6

; --- Disable Dangerous Functions ---
; Functions disabled for security (Bitrix-compatible list)
disable_functions = exec,passthru,shell_exec,system,proc_open,popen,parse_ini_file,show_source,pcntl_exec

; --- Open Basedir Restriction ---
; Restrict PHP to specific directories (Bitrix-compatible)
; Note: This may need adjustment based on your specific setup
; open_basedir = /home/bitrix/app:/home/bitrix/tmp:/var/lib/php/sessions:/tmp

; --- File Upload Security ---
file_uploads = On
upload_max_filesize = 1024M
max_file_uploads = 100

; --- Error Handling Security ---
display_errors = Off
display_startup_errors = Off
log_errors = On
html_errors = Off

; --- Memory & Execution Limits ---
memory_limit = 512M
max_execution_time = 300
max_input_time = 300
max_input_vars = 10000

; --- Disable potentially dangerous PHP features ---
; Note: Some may be needed by Bitrix, enable if required
; disable_classes =

; --- CGI Security ---
cgi.force_redirect = On

; --- Mail Security ---
mail.add_x_header = Off

; --- PHAR Security ---
; Disable PHAR read/write to prevent potential security exploits
; PHAR files can be used to bypass security restrictions
phar.readonly = On
phar.require_hash = On
; Disable PHAR stream wrapper - blocks phar:// protocol
; Note: To fully disable PHAR, it must be compiled without --enable-phar
; This setting prevents PHAR file creation and some attack vectors
