# =============================================================================
# MAIN SITE - ${DOMAIN}
# HTTP server for local/dev or when SSL is handled by proxy
# Multi-site structure: www/${DOMAIN}/www/
# =============================================================================
server {
    listen 80;
    server_name ${DOMAIN} www.${DOMAIN};

    charset utf-8;
    index index.php;
    root /home/${UGN}/app/${DOMAIN}/www;
    server_tokens off;

    access_log /dev/stdout;
    error_log /dev/stderr;

    client_max_body_size 128m;

    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;

    # Block hidden files (except .default used by Bitrix themes)
    location ~ /\.(?!default|well-known) {
        deny all;
        access_log off;
        log_not_found off;
    }

    # Block backup and config files
    location ~* \.(bak|backup|old|orig|tmp|temp|sql|log|conf|ini|swp|~|env|git|svn|htaccess|htpasswd)${DOLLAR} {
        deny all;
        access_log off;
        log_not_found off;
    }

    include /etc/nginx/snippets/resolver.conf;
    include /etc/nginx/snippets/bitrix.conf;
}
