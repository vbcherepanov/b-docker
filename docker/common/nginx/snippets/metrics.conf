# Metrics server for Prometheus exporters
# Internal only - not exposed to outside

server {
    listen 8080;
    server_name _;

    # Nginx stub_status for nginx-exporter
    location /nginx_status {
        stub_status on;
        access_log off;
        allow 172.16.0.0/12;  # Docker networks
        allow 10.0.0.0/8;     # Internal networks
        allow 127.0.0.1;
        deny all;
    }

    # PHP-FPM status for php-fpm-exporter
    location /status {
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_pass bitrix:9000;
        access_log off;
        allow 172.16.0.0/12;
        allow 10.0.0.0/8;
        allow 127.0.0.1;
        deny all;
    }

    # PHP-FPM ping
    location /ping {
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_pass bitrix:9000;
        access_log off;
        allow 172.16.0.0/12;
        allow 10.0.0.0/8;
        allow 127.0.0.1;
        deny all;
    }
}
